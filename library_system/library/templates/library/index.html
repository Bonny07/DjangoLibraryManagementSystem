<!DOCTYPE html>
<html>
<head>
    <title>Library Management System</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'library/styles.css' %}">
</head>
<body>
    <div class="container">
        <h1>Library Books</h1>

        <!-- 按钮 -->
        <div class="button-container">
            <a href="{% url 'my_books' %}" class="button">My Books</a>
            <a href="{% url 'index' %}?edit_mode={{ new_edit_mode }}" class="button">{{ edit_button_text }}</a>
        </div>

        <!-- 显示消息 -->
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- 搜索表单 -->
        <div class="search-container">
            <form method="get" action="{% url 'index' %}">
                <label for="search_id">ID:</label>
                <input type="text" name="search_id" id="search_id" value="{{ request.GET.search_id }}">
                <label for="search_title">Title:</label>
                <input type="text" name="search_title" id="search_title" value="{{ request.GET.search_title }}">
                <label for="search_author">Author:</label>
                <select name="search_author" id="search_author">
                    <option value="">All</option>
                    {% for author in authors %}
                        <option value="{{ author.id }}" {% if request.GET.search_author == author.id|stringformat:"s" %}selected{% endif %}>{{ author.name }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Search</button>
                <a href="{% url 'index' %}" class="button reset-button">Reset</a>
            </form>
        </div>

        <!-- 图书表格 -->
        <table class="book-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Year</th>
                    <th>Total Quantity</th>
                    <th>Available Quantity</th>
                    <th>Action</th>
                    {% if edit_mode %}
                        <th>Delete</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for book in books %}
                    <tr>
                        <td>{{ book.id }}</td>
                        <td>{{ book.title }}</td>
                        <td>{{ book.author.name }}</td>
                        <td>{{ book.published_date.year }}</td>
                        <td>{{ book.total_quantity }}</td>
                        <td>{{ book.available_quantity }}</td>
                        <td>
                            <a href="{% url 'borrow_book' book.id %}" class="button {% if book.available_quantity > 0 %}button-green{% else %}button-disabled{% endif %}">
                                Borrow
                            </a>
                        </td>
                        {% if edit_mode %}
                            <td>
                                <a href="{% url 'delete_book' book.id %}" class="button button-red">Delete</a>
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
                {% if edit_mode %}
                    <tr>
                        <form method="post" action="{% url 'add_book' %}">
                            {% csrf_token %}
                            <td>New</td>
                            <td><input type="text" name="title" required></td>
                            <td>
                                <select name="author" required>
                                    <option value="">Select</option>
                                    {% for author in authors %}
                                        <option value="{{ author.id }}">{{ author.name }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td><input type="number" name="published_date" required></td>
                            <td><input type="number" name="total_quantity" required></td>
                            <td><input type="number" name="available_quantity" required></td>
                            <td><button type="submit" class="button button-blue">Add</button></td>
                        </form>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</body>
</html>
